<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Hoolog</title>
  <link rel="stylesheet" href="styles.css">
  <!-- flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
  <header>
    <div class="container" style="justify-content: space-between; align-items: center; display: flex;">
      <h1 class="blog-title">Hoolog</h1>
      <nav>
        <ul style="list-style: none; display: flex; gap: 1.5rem; margin: 0; padding: 0;">
          <li><a href="#" id="records-link" style="color: #fff; text-decoration: none; font-weight: 500;">Records</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <main class="container" style="display: flex; flex-direction: column; align-items: center;">
    <section class="blog-inputs" style="width: 100%; max-width: 600px;">
      <input type="date" id="date-picker" style="margin-bottom: 1rem; width: 200px;">
      <form id="post-form">
        <label for="post-content">Content:</label>
        <textarea id="post-content" placeholder="Write your post here..." required style="width: 100%; min-width: 400px; height: 200px;"></textarea>
        <button type="submit">Add Post</button>
      </form>
    </section>
    <section class="posts" id="posts-section" style="width: 100%; max-width: 600px; display: flex; flex-direction: column; align-items: center;"></section>
    <div id="trash-can" style="position: fixed; bottom: 32px; right: 32px; z-index: 1000; cursor: pointer; width: 56px; height: 56px; display: flex; align-items: center; justify-content: center; background: #fff; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.12);">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#d32f2f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="6" width="18" height="14" rx="2"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
    </div>
  </main>
  <footer>
    <div class="container">
      <p>&copy; 2024 My Personal Blog. All rights reserved.</p>
    </div>
  </footer>
  <!-- flatpickr JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // Helper: Get posts from localStorage
    function getStoredPosts() {
      const posts = localStorage.getItem('blogPosts');
      return posts ? JSON.parse(posts) : [];
    }
    // Helper: Save posts to localStorage
    function savePosts(posts) {
      localStorage.setItem('blogPosts', JSON.stringify(posts));
    }
    // Group posts by date (YYYY-MM-DD)
    function groupPostsByDate(posts) {
      const grouped = {};
      posts.forEach(post => {
        if (!grouped[post.date]) grouped[post.date] = [];
        grouped[post.date].push(post);
      });
      return grouped;
    }
    // Render all posts, grouped by day
    function renderPosts(filterDate = null) {
      const postSection = document.getElementById('posts-section');
      postSection.innerHTML = '';
      const posts = getStoredPosts();
      const grouped = groupPostsByDate(posts);
      // Get sorted dates (descending)
      const dates = Object.keys(grouped).sort((a, b) => b.localeCompare(a));
      dates.forEach(date => {
        if (filterDate && date !== filterDate) return;
        const article = document.createElement('article');
        article.className = 'post-day';
        article.style = 'margin-bottom: 2rem; width: 100%; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 1.5rem; display: flex; flex-direction: column; align-items: center;';
        const dateHeader = document.createElement('h2');
        dateHeader.textContent = date;
        dateHeader.style = 'text-align: center; margin-bottom: 1rem; font-size: 1.2rem; color: #444;';
        article.appendChild(dateHeader);
        grouped[date].forEach((post, idx) => {
          const noteDiv = document.createElement('div');
          noteDiv.className = 'note';
          noteDiv.style = 'margin-bottom: 0.5rem; width: 100%; display: flex; flex-direction: column; align-items: center; background: #f9f9f9; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.03); padding: 0.75rem; cursor: grab;';
          noteDiv.setAttribute('draggable', 'true');
          noteDiv.setAttribute('data-date', date);
          noteDiv.setAttribute('data-idx', idx);
          noteDiv.innerHTML = `
            <p class="post-content" style="margin: 0 auto; text-align: center;">${post.content}</p>
          `;
          article.appendChild(noteDiv);
        });
        postSection.appendChild(article);
      });
      // Drag and drop for deleting notes
      const trashCan = document.getElementById('trash-can');
      document.querySelectorAll('.note').forEach(note => {
        note.addEventListener('dragstart', function(e) {
          e.dataTransfer.setData('text/plain', JSON.stringify({ date: note.getAttribute('data-date'), idx: note.getAttribute('data-idx') }));
          trashCan.style.background = '#ffeaea';
        });
        note.addEventListener('dragend', function() {
          trashCan.style.background = '#fff';
        });
      });
      trashCan.ondragover = function(e) {
        e.preventDefault();
        trashCan.style.background = '#ffd6d6';
      };
      trashCan.ondragleave = function() {
        trashCan.style.background = '#ffeaea';
      };
      trashCan.ondrop = function(e) {
        e.preventDefault();
        trashCan.style.background = '#fff';
        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        deletePost(data.date, parseInt(data.idx));
      };
    }
    // Delete a post by date and index
    function deletePost(date, idx) {
      const posts = getStoredPosts();
      const grouped = groupPostsByDate(posts);
      if (grouped[date]) {
        grouped[date].splice(idx, 1);
        if (grouped[date].length === 0) delete grouped[date];
      }
      // Flatten grouped back to array
      const newPosts = [];
      Object.keys(grouped).forEach(d => grouped[d].forEach(p => newPosts.push(p)));
      savePosts(newPosts);
      renderPosts(document.getElementById('date-picker').value || null);
    }
    // Add new blog post
    document.getElementById('post-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const content = document.getElementById('post-content').value;
      const name = 'Seonhoo Kim';
      let date = document.getElementById('date-picker').value;
      if (!date) {
        // Default to today
        const now = new Date();
        date = now.toISOString().slice(0, 10);
      }
      // Save to localStorage
      const posts = getStoredPosts();
      posts.push({ content, author: name, date });
      savePosts(posts);
      renderPosts(date);
      document.getElementById('post-content').value = '';
    });
    // Date picker filter
    document.getElementById('date-picker').addEventListener('change', function() {
      const date = this.value;
      renderPosts(date || null);
    });
    // Records link shows all
    document.getElementById('records-link').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('date-picker').value = '';
      renderPosts();
    });
    // On page load, render posts
    window.addEventListener('DOMContentLoaded', renderPosts);
    // Initialize flatpickr in English
    flatpickr("#date-picker", { locale: "en" });
  </script>
</body>
</html> 